!async function(){let e=["ultima","master","expert"],t=[],n=!1,i=!1,a="https://chuni-log.com";function l(e){let t=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let i=0;i<n.length;i++){let a=n[i];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}async function o(e,a){let o=e.charAt(0).toUpperCase()+e.slice(1),r=new FormData;return r.append("genre",99),r.append("token",l("_t")),fetch("https://chunithm-net-eng.com/mobile/record/musicGenre/send"+o,{method:"POST",body:r,credentials:"include"}).then(function(e){return e.text()}).then(function(n){var i=new DOMParser().parseFromString(n,"text/html");let a=$(i).find(".musiclist_box");if(a.length<=0)throw"fail, please login and try again";for(let l=0;l<a.length;l++){let o=a[l].getElementsByClassName("play_musicdata_highscore")[0];if(o){let r=a[l].getElementsByClassName("music_title")[0].innerText,s=$(o).find("span")[0].innerText.split(",").join("");parseInt(s)>=0&&t.push({name:r,difficulty:e,score:parseInt(s),type:"best"})}}}).catch(e=>{n=!1,i||(i=!0,alert(e))})}function r(e){return({4:"ultima",3:"master",2:"expert"})[e]}async function s(){let e=new FormData;return e.append("token",l("_t")),fetch("https://chunithm-net-eng.com/mobile/home/playerData/ratingDetailRecent/",{method:"POST",body:e,credentials:"include"}).then(function(e){return e.text()}).then(function(e){var n=new DOMParser().parseFromString(e,"text/html");let i=$(n).find(".musiclist_box");if(i.length<=0)throw"fail, please login and try again";for(let a=0;a<i.length;a++){let l=r($(i[a]).find("input[type=hidden]")[0].value),o=i[a].getElementsByClassName("play_musicdata_highscore")[0];if(o){let s=i[a].getElementsByClassName("music_title")[0].innerText,c=$(o).find("span")[0].innerText.split(",").join("");parseInt(c)>=0&&t.push({name:s,difficulty:l,score:parseInt(c),type:"recent"})}}}).catch(e=>{n=!1,i||(i=!0,alert(e))})}async function c(){try{for(let i=0;i<e.length;i++)await o(e[i]);await s()}catch(l){n=!1,console.log("calculateRating",l)}if(t.length<=0)throw"no songs record, please retry";console.table(t),fetch(a+"/api/record/"+userID,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t})}).then(e=>e.text()).then(e=>{window.location=a}).catch(e=>{alert(e)}).finally(()=>{n=!1})}if(userID){let h;n=!0,(h=$(".sleep_penguin img").clone().appendTo("body")).css({position:"absolute",top:"200px","z-index":"200"}),function e(t){t.animate({left:Math.random()*(window.innerWidth-60)+"px",top:Math.random()*(window.innerHeight-88)+"px"},1e3,function(){n?e(t):t.remove()})}(h),await c()}else alert("Invalid!")}();
